<div class="reports-container">
  <div class="page-header">
    <div>
      <h1>üìä Reports & Analytics</h1>
      <p>View insights and performance metrics</p>
    </div>
    <div class="header-actions">
      <select class="date-range-select" [(ngModel)]="dateRange" (change)="loadReports()">
        <option value="week">Last Week</option>
        <option value="month">Last Month</option>
        <option value="quarter">Last Quarter</option>
        <option value="year">Last Year</option>
      </select>
      <button class="btn-secondary" (click)="printReport()">üñ®Ô∏è Print</button>
      <div class="export-dropdown">
        <button class="btn-primary">üì• Export</button>
        <div class="dropdown-menu">
          <button (click)="exportReport('pdf')">PDF</button>
          <button (click)="exportReport('excel')">Excel</button>
          <button (click)="exportReport('csv')">CSV</button>
        </div>
      </div>
    </div>
  </div>

  <div class="reports-content" *ngIf="!loading">
    <!-- Key Metrics -->
    <div class="metrics-grid">
      <div class="metric-card scale-in stagger-1">
        <div class="metric-icon revenue pulse">üí∞</div>
        <div class="metric-info">
          <div class="metric-label">Total Revenue</div>
          <div class="metric-value gradient-text">{{ stats.totalRevenue.toFixed(2) }} DH</div>
          <div class="metric-change positive">+12.5%</div>
        </div>
      </div>

      <div class="metric-card scale-in stagger-2">
        <div class="metric-icon bills pulse">üìÑ</div>
        <div class="metric-info">
          <div class="metric-label">Total Bills</div>
          <div class="metric-value gradient-text">{{ stats.totalBills }}</div>
          <div class="metric-change positive">+8.3%</div>
        </div>
      </div>

      <div class="metric-card scale-in stagger-3">
        <div class="metric-icon average pulse">üíµ</div>
        <div class="metric-info">
          <div class="metric-label">Average Bill</div>
          <div class="metric-value">{{ stats.averageBill.toFixed(2) }} DH</div>
          <div class="metric-change negative">-2.1%</div>
        </div>
      </div>

      <div class="metric-card scale-in stagger-4">
        <div class="metric-icon customers pulse">üë•</div>
        <div class="metric-info">
          <div class="metric-label">Active Customers</div>
          <div class="metric-value gradient-text">{{ stats.totalCustomers }}</div>
          <div class="metric-change positive">+15.7%</div>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
      <!-- Revenue Chart -->
      <div class="chart-card fade-in-up stagger-1">
        <div class="chart-header">
          <h3>Revenue Trend</h3>
          <span class="chart-period">Last 6 Months</span>
        </div>
        <div class="chart-content">
          <div class="bar-chart">
            <div class="bar-item" *ngFor="let data of revenueData">
              <div class="bar-wrapper">
                <div 
                  class="bar" 
                  [style.height.%]="(data.revenue / 25000) * 100">
                </div>
              </div>
              <div class="bar-label">{{ data.month }}</div>
              <div class="bar-value">{{ (data.revenue / 1000).toFixed(1) }}k</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Categories -->
      <div class="chart-card fade-in-up stagger-2">
        <div class="chart-header">
          <h3>Product Distribution</h3>
          <span class="chart-period">By Category</span>
        </div>
        <div class="chart-content">
          <div class="donut-chart">
            <div class="donut-center">
              <div class="donut-value">{{ stats.totalProducts }}</div>
              <div class="donut-label">Products</div>
            </div>
          </div>
          <div class="category-legend">
            <div class="legend-item" *ngFor="let cat of productCategories">
              <div class="legend-color" [style.background]="cat.color"></div>
              <span class="legend-name">{{ cat.name }}</span>
              <span class="legend-percent">{{ cat.value }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tables Row -->
    <div class="tables-row">
      <!-- Top Products -->
      <div class="table-card">
        <div class="table-header">
          <h3>üèÜ Top Products</h3>
        </div>
        <div class="table-content">
          <table>
            <thead>
              <tr>
                <th>Rank</th>
                <th>Product</th>
                <th>Sales</th>
                <th>Revenue</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of stats.topProducts; let i = index">
                <td>
                  <span class="rank" [class.top]="i < 3">{{ i + 1 }}</span>
                </td>
                <td>{{ product.name }}</td>
                <td>{{ product.quantity }}</td>
                <td class="revenue-cell">{{ product.revenue.toFixed(2) }} DH</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Top Customers -->
      <div class="table-card">
        <div class="table-header">
          <h3>‚≠ê Top Customers</h3>
        </div>
        <div class="table-content">
          <table>
            <thead>
              <tr>
                <th>Rank</th>
                <th>Customer</th>
                <th>Orders</th>
                <th>Total Spent</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let customer of stats.topCustomers; let i = index">
                <td>
                  <span class="rank" [class.top]="i < 3">{{ i + 1 }}</span>
                </td>
                <td>{{ customer.name }}</td>
                <td>{{ customer.orders }}</td>
                <td class="revenue-cell">{{ customer.spent.toFixed(2) }} DH</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading reports...</p>
  </div>
</div>
